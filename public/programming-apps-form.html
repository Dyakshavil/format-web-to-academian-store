<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·Ø¨ÙŠÙ‚Ø§Øª - Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* CSS Variables Fallbacks */
        :root {
            --primary: #6366f1;
            --bg-secondary: #1e293b;
            --text-secondary: #cbd5e1;
        }

        /* ===== TYPE SELECTOR ===== */
        .type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .type-card {
            border: 2px solid #334155;
            border-radius: 12px;
            padding: 1.5rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.25s ease;
            background: #1e293b;
        }
        .type-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(99,102,241,.15);
        }
        .type-card.active {
            border-color: var(--primary);
            background: rgba(99,102,241,.1);
            box-shadow: 0 6px 20px rgba(99,102,241,.2);
        }
        .type-card .type-icon { font-size: 2.2rem; margin-bottom: .5rem; }
        .type-card h3 { font-size: 1rem; margin: 0 0 .3rem; color: #fff; }
        .type-card p  { font-size: .8rem; color: #94a3b8; margin: 0; }

        /* ===== SUB-FORMS ===== */
        .sub-form { display: none; }
        .sub-form.active { display: block; }

        /* ===== PAGE BUILDER ===== */
        .page-entry {
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: .8rem;
            background: #1a1f3a;
            position: relative;
        }
        .page-entry-header {
            display: flex;
            align-items: center;
            gap: .6rem;
            margin-bottom: .6rem;
            font-weight: 600;
            color: #f1f5f9;
        }
        .page-entry-header .page-num {
            background: var(--primary);
            color:#fff;
            border-radius:50%;
            width:24px;
            height:24px;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:.8rem;
            flex-shrink:0;
        }
        .remove-page-btn {
            position: absolute;
            top: .6rem;
            left: .6rem;
            background: #450a0a;
            color: #ef4444;
            border: 1px solid #7f1d1d;
            border-radius: 6px;
            padding: .2rem .5rem;
            cursor: pointer;
            font-size:.8rem;
        }

        .add-page-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: .4rem;
            width: 100%;
            padding: .7rem;
            border: 2px dashed #334155;
            border-radius: 10px;
            background: transparent;
            color: #94a3b8;
            font-size: .9rem;
            cursor: pointer;
            transition: all .2s;
            margin-top: .4rem;
        }
        .add-page-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* ===== TOGGLE BUTTONS (REFIXED) ===== */
        .toggles-row {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
            margin-bottom: .5rem;
        }
        .toggle-item {
            display: flex;
            align-items: center;
            gap: .5rem;
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 8px;
            padding: .6rem 1rem;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            color: #94a3b8;
        }
        .toggle-item:hover {
            border-color: #475569;
        }
        .toggle-item.on {
            background: rgba(99,102,241,.15);
            border-color: var(--primary);
            color: #fff;
            box-shadow: 0 0 15px rgba(99,102,241,.2);
        }
        .toggle-item input[type=checkbox] {
            display: none;
        }

        /* ===== SECTION DIVIDER ===== */
        .section-divider {
            border: none;
            border-top: 1px dashed #334155;
            margin: 1.5rem 0;
        }
        .section-label {
            font-size: .85rem;
            font-weight: 700;
            color: #818cf8;
            text-transform: uppercase;
            letter-spacing: .05em;
            margin-bottom: .7rem;
        }

        @media(max-width:600px){
            .type-selector { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo">ğŸ“ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</div>
            <ul class="nav-links">
                <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="my-orders.html">Ø·Ù„Ø¨Ø§ØªÙŠ</a></li>
                <li><a href="admin-panel.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <div class="form-container fade-in">
            <h2>ğŸ–¥ï¸ Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·Ø¨ÙŠÙ‚Ø§Øª</h2>
            <p class="text-secondary mb-lg">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡ ÙˆØ³Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ù…Ù„ ÙÙˆØ±Ø§Ù‹</p>

            <!-- ===== STEP 1: TYPE SELECTOR ===== -->
            <div class="type-selector" id="typeSelector">
                <div class="type-card" onclick="selectType('game')" id="card-game">
                    <div class="type-icon">ğŸ®</div>
                    <h3>Ù„Ø¹Ø¨Ø© Ø¨Ø³ÙŠØ·Ø©</h3>
                    <p>Ø£Ù„Ø¹Ø§Ø¨ 2DØŒ Ø£Ù„Ø¹Ø§Ø¨ ØªØ¹Ù„ÙŠÙ…ÙŠØ©ØŒ Ø£Ùˆ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø£Ø·ÙØ§Ù„</p>
                </div>
                <div class="type-card" onclick="selectType('program')" id="card-program">
                    <div class="type-icon">ğŸ’»</div>
                    <h3>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ø³ÙŠØ·</h3>
                    <p>Ø¨Ø±Ø§Ù…Ø¬ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©ØŒ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§ØªØŒ Ø£Ùˆ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¨Ø³ÙŠØ·Ø©</p>
                </div>
                <div class="type-card" onclick="selectType('project')" id="card-project">
                    <div class="type-icon">ğŸš€</div>
                    <h3>Ù…Ø´Ø±ÙˆØ¹ Ø£ÙƒØ¨Ø±</h3>
                    <p>Ø£Ù†Ø¸Ù…Ø© Ù…ØªÙƒØ§Ù…Ù„Ø© ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹ ØªØ®Ø±Ø¬ Ø¶Ø®Ù…Ø©</p>
                </div>
            </div>

            <!-- ===== COMMON FIELDS ===== -->
            <div id="commonFields" style="display:none;">
                <div class="form-group">
                    <label for="customerName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label for="customerEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                    <input type="email" id="customerEmail" required>
                </div>
                <div class="form-group">
                    <label for="deadline">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ *</label>
                    <input type="date" id="deadline" required>
                </div>
            </div>

            <!-- =========================================
                 FORM 1: SIMPLE GAME
            ========================================= -->
            <div class="sub-form" id="form-game">
                <hr class="section-divider">
                <p class="section-label">ğŸ® ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</p>

                <div class="form-group">
                    <label>ÙˆØµÙ Ø§Ù„Ù„Ø¹Ø¨Ø© *</label>
                    <textarea id="gameDesc" placeholder="Ø§Ø´Ø±Ø­ ÙÙƒØ±Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ù„Ø¹Ø¨..."></textarea>
                </div>

                <div class="form-group">
                    <label>Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© *</label>
                    <select id="gameStyle">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ØªØ§ÙŠÙ„</option>
                        <option value="platform">Ù…Ù†ØµØ§Øª (Platformer)</option>
                        <option value="puzzle">Ø£Ù„ØºØ§Ø² (Puzzle)</option>
                        <option value="kids">Ø£Ø·ÙØ§Ù„ (Kids)</option>
                        <option value="strategy">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© (Strategy)</option>
                        <option value="other">Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>

                <hr class="section-divider">
                <p class="section-label">ğŸ“„ Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</p>
                <div id="gamePagesContainer"></div>
                <button type="button" class="add-page-btn" onclick="addGamePage()">â• Ø¥Ø¶Ø§ÙØ© Ø´Ø§Ø´Ø©</button>

                <hr class="section-divider">
                <p class="section-label">ğŸ›ï¸ Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</p>
                <div class="toggles-row">
                    <label class="toggle-item" id="label-home">
                        <input type="checkbox" id="btn-home" onchange="this.parentElement.classList.toggle('on', this.checked)">
                        ğŸ  Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </label>
                    <label class="toggle-item" id="label-sound">
                        <input type="checkbox" id="btn-sound" onchange="this.parentElement.classList.toggle('on', this.checked)">
                        ğŸ”Š Ø²Ø± Ø§Ù„ØµÙˆØª
                    </label>
                    <label class="toggle-item" id="label-score">
                        <input type="checkbox" id="btn-score" onchange="this.parentElement.classList.toggle('on', this.checked)">
                        ğŸ† Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·
                    </label>
                </div>

                <div class="form-group mt-lg">
                    <label class="toggle-item" id="label-voice">
                        <input type="checkbox" id="hasVoice" onchange="handleVoiceToggle(this)">
                        ğŸ™ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£ØµÙˆØ§ØªØ§Ù‹ Ø¨Ø´Ø±ÙŠØ©ØŸ
                    </label>
                    <div id="voiceSection" style="display:none; margin-top:1rem;">
                        <div id="voiceContainer"></div>
                        <button type="button" class="add-page-btn" onclick="addVoice()">â• Ø¥Ø¶Ø§ÙØ© Ù†Øµ ØµÙˆØªÙŠ</button>
                    </div>
                </div>
            </div>

            <!-- =========================================
                 FORM 2: SIMPLE PROGRAM
            ========================================= -->
            <div class="sub-form" id="form-program">
                <hr class="section-divider">
                <p class="section-label">ğŸ’» ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</p>
                <div class="form-group">
                    <label>ÙˆØµÙ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙˆÙ‡Ø¯ÙÙ‡ *</label>
                    <textarea id="progDesc" placeholder="Ø§Ø´Ø±Ø­ Ù…Ø§Ø°Ø§ ÙŠÙØ¹Ù„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬..."></textarea>
                </div>
                <div class="form-group">
                    <label>Ù„ØºØ© Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©</label>
                    <select id="progLang">
                        <option value="Python">Python</option>
                        <option value="Java">Java</option>
                        <option value="C++">C++</option>
                        <option value="CSharp">C#</option>
                    </select>
                </div>
                <hr class="section-divider">
                <div id="progPagesContainer"></div>
                <button type="button" class="add-page-btn" onclick="addProgPage()">â• Ø¥Ø¶Ø§ÙØ© Ø´Ø§Ø´Ø© / ÙˆØ­Ø¯Ø©</button>
            </div>

            <!-- =========================================
                 FORM 3: BIG PROJECT
            ========================================= -->
            <div class="sub-form" id="form-project">
                <hr class="section-divider">
                <p class="section-label">ğŸš€ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø¶Ø®Ù…</p>
                <div class="form-group">
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label>
                    <input type="text" id="projTitle" placeholder="Ù…Ø«Ø§Ù„: Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø³ØªØ´ÙÙ‰">
                </div>
                <div class="form-group">
                    <label>ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ØªÙØµÙŠÙ„ÙŠØ§Ù‹ *</label>
                    <textarea id="projDesc" placeholder="Ø§Ø´Ø±Ø­ ÙƒÙ„ Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡..."></textarea>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ù†ØµØ©</label>
                    <select id="projPlatform">
                        <option value="Web">Ù…ÙˆÙ‚Ø¹ ÙˆÙŠØ¨ (Web)</option>
                        <option value="Desktop">ØªØ·Ø¨ÙŠÙ‚ Ø³Ø·Ø­ Ù…ÙƒØªØ¨ (Desktop)</option>
                        <option value="Mobile">ØªØ·Ø¨ÙŠÙ‚ Ù…ÙˆØ¨Ø§ÙŠÙ„ (Mobile)</option>
                    </select>
                </div>
            </div>

            <!-- ===== SUBMIT ===== -->
            <div id="formActions" style="display:none; margin-top:2rem;">
                <hr class="section-divider">
                <div class="form-actions">
                    <a href="index.html" class="btn btn-secondary">Ø¥Ù„ØºØ§Ø¡</a>
                    <button type="button" class="btn btn-primary" id="submitBtn" onclick="submitForm()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
                <div id="errorBox" style="display:none; color:#ef4444; background:rgba(239,68,68,0.1); padding:1rem; border-radius:8px; margin-top:1rem; font-size:0.9rem; text-align:center;"></div>
            </div>
        </div>
    </main>

    <script src="app.js"></script>
    <script>
        let currentType = null;
        let gamePageCount = 0;
        let progPageCount = 0;
        let voiceCount = 0;

        function selectType(type) {
            currentType = type;
            document.querySelectorAll('.type-card').forEach(c => c.classList.remove('active'));
            document.getElementById('card-' + type).classList.add('active');
            document.querySelectorAll('.sub-form').forEach(f => f.classList.remove('active'));
            document.getElementById('form-' + type).classList.add('active');
            document.getElementById('commonFields').style.display = 'block';
            document.getElementById('formActions').style.display = 'block';
            
            if (type === 'game' && gamePageCount === 0) addGamePage();
            if (type === 'program' && progPageCount === 0) addProgPage();
        }

        function addGamePage() {
            gamePageCount++;
            const container = document.getElementById('gamePagesContainer');
            const div = document.createElement('div');
            div.className = 'page-entry';
            div.id = 'game-p-' + gamePageCount;
            div.innerHTML = `
                <div class="page-entry-header"><span class="page-num">${gamePageCount}</span> Ø´Ø§Ø´Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
                <button type="button" class="remove-page-btn" onclick="this.parentElement.remove()">Ø­Ø°Ù</button>
                <input type="text" class="g-page-input" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŒ Ø´Ø§Ø´Ø© Ù…Ø±Ø§Ø­Ù„...">
            `;
            container.appendChild(div);
        }

        function addProgPage() {
            progPageCount++;
            const container = document.getElementById('progPagesContainer');
            const div = document.createElement('div');
            div.className = 'page-entry';
            div.id = 'prog-p-' + progPageCount;
            div.innerHTML = `
                <div class="page-entry-header"><span class="page-num">${progPageCount}</span> Ø´Ø§Ø´Ø© / ÙˆØ­Ø¯Ø©</div>
                <button type="button" class="remove-page-btn" onclick="this.parentElement.remove()">Ø­Ø°Ù</button>
                <input type="text" class="p-page-input" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ ÙˆØ­Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª...">
            `;
            container.appendChild(div);
        }

        function handleVoiceToggle(cb) {
            cb.parentElement.classList.toggle('on', cb.checked);
            document.getElementById('voiceSection').style.display = cb.checked ? 'block' : 'none';
            if (cb.checked && voiceCount === 0) addVoice();
        }

        function addVoice() {
            voiceCount++;
            const container = document.getElementById('voiceContainer');
            const div = document.createElement('div');
            div.className = 'page-entry';
            div.innerHTML = `
                <button type="button" class="remove-page-btn" onclick="this.parentElement.remove()">Ø­Ø°Ù</button>
                <input type="text" class="voice-loc" placeholder="Ø£ÙŠÙ† ÙŠØ¸Ù‡Ø± Ø§Ù„ØµÙˆØªØŸ (Ù…Ø«Ø§Ù„: Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1)">
                <textarea class="voice-txt" placeholder="Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ù†Ø·ÙˆÙ‚..." style="min-height:60px; margin-top:5px;"></textarea>
            `;
            container.appendChild(div);
        }

        async function submitForm() {
            const errorBox = document.getElementById('errorBox');
            errorBox.style.display = 'none';

            const name = document.getElementById('customerName').value.trim();
            const email = document.getElementById('customerEmail').value.trim();
            const deadline = document.getElementById('deadline').value;

            if (!name || !email || !deadline) {
                alert('â— ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆØ§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ');
                return;
            }

            let details = { deadline, subType: currentType };

            if (currentType === 'game') {
                details.desc = document.getElementById('gameDesc').value;
                details.style = document.getElementById('gameStyle').value;
                details.pages = Array.from(document.querySelectorAll('.g-page-input')).map(i => i.value);
                details.toggles = {
                    home: document.getElementById('btn-home').checked,
                    sound: document.getElementById('btn-sound').checked,
                    score: document.getElementById('btn-score').checked
                };
                details.voices = Array.from(document.querySelectorAll('#voiceContainer .page-entry')).map(e => ({
                    loc: e.querySelector('.voice-loc').value,
                    txt: e.querySelector('.voice-txt').value
                }));
            } else if (currentType === 'program') {
                details.desc = document.getElementById('progDesc').value;
                details.lang = document.getElementById('progLang').value;
                details.pages = Array.from(document.querySelectorAll('.p-page-input')).map(i => i.value);
            } else {
                details.title = document.getElementById('projTitle').value;
                details.desc = document.getElementById('projDesc').value;
                details.platform = document.getElementById('projPlatform').value;
            }

            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

            try {
                const response = await fetch(API_BASE + '/api/orders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        service_type: 'coding_' + currentType,
                        customer_name: name,
                        customer_email: email,
                        details: details
                    })
                });

                const result = await response.json();
                if (result.success) {
                    alert('âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­!');
                    window.location.href = 'my-orders.html?email=' + email;
                } else {
                    errorBox.innerText = 'âŒ ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨: ' + (result.details || result.error);
                    errorBox.style.display = 'block';
                    console.error('Server error:', result);
                }
            } catch (err) {
                errorBox.innerText = 'âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±. ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ´ØºÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.';
                errorBox.style.display = 'block';
            } finally {
                btn.disabled = false;
                btn.innerText = 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨';
            }
        }
    </script>
</body>
</html>
